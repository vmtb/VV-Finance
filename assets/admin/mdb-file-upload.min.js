"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e,i){"function"==typeof define&&define.amd?define(["jquery"],i):"object"==typeof exports?module.exports=i(require("jquery")):e.file_upload=i(e.jQuery)}(this,function(l){var i="file_upload";function t(e,i){window.File&&window.FileReader&&window.FileList&&window.Blob&&(this.element=e,this.input=l(this.element),this.wrapper=null,this.preview=null,this.filenameWrapper=null,this.settings=l.extend(!0,{defaultFile:"",maxFileSize:0,minWidth:0,maxWidth:0,minHeight:0,maxHeight:0,showRemove:!0,showLoader:!0,showErrors:!0,errorTimeout:3e3,errorsPosition:"overlay",imgFileExtensions:["png","jpg","jpeg","gif","bmp"],maxFileSizePreview:"5M",allowedFormats:["portrait","square","landscape"],allowedFileExtensions:["*"],messages:{default:"<small>Glisser-déposer une image ou cliquer</small>",replace:"<small>Glisser-déposer ou cliquer pour remplacer</small>",remove:"",error:"Oups, une erreur est survenue."},error:{fileSize:"L'image est trop lourde ({{ value }} max).",minWidth:"La largeur de l'image est trop petite ({{ value }}px min).",maxWidth:"La largeur de l'image est trop grande ({{ value }}px max).",minHeight:"La hauteur de l'image est trop petite ({{ value }}px min).",maxHeight:"La hauteur de l'image est trop grande ({{ value }}px max).",imageFormat:"Le format de l'image n'est pas autorisé ({{ value }} uniquement).",fileExtension:"Ce type de fichier n'est pas autorisé ({{ value }} uniquement)."},tpl:{wrap:'<div class="card card-body bg-light view file-upload"></div>',loader:'<div class="mask rgba-stylish-slight"></div>',message:'<div class="card-text file-upload-message"><i class="fas fa-camera-alt"></i><p>{{ default }}</p></div>',preview:'<div class="file-upload-preview"><span class="file-upload-render"></span><div class="file-upload-infos"><div class="file-upload-infos-inner"><p class="file-upload-infos-message">{{ replace }}</p></div></div></div>',filename:'<p class="file-upload-filename"><span class="file-upload-filename-inner"></span></p>',clearButton:'<button type="button" class="btn btn-sm btn-danger fileinput-remove">{{ remove }}<i class="far fa-trash-alt"></i></button>',errorLine:'<p class="file-upload-error">{{ error }}</p>',errorsContainer:'<div class="file-upload-errors-container"><ul></ul></div>'}},i,this.input.data()),this.errorsEvent=l.Event("file_upload.errors"),this.isDisabled=!1,this.isInit=!1,this.file={object:null,name:null,size:null,width:null,height:null,type:null},Array.isArray(this.settings.allowedFormats)||(this.settings.allowedFormats=this.settings.allowedFormats.split(" ")),Array.isArray(this.settings.allowedFileExtensions)||(this.settings.allowedFileExtensions=this.settings.allowedFileExtensions.split(" ")),this.onChange=this.onChange.bind(this),this.clearElement=this.clearElement.bind(this),this.onFileReady=this.onFileReady.bind(this),this.translateMessages(),this.createElements(),this.setContainerSize(),this.errorsEvent.errors=[],this.input.on("change",this.onChange))}return t.prototype.onChange=function(){this.resetPreview(),this.readFile(this.element)},t.prototype.createElements=function(){this.isInit=!0,this.input.wrap(l(this.settings.tpl.wrap)),this.wrapper=this.input.parent();var e=l(this.settings.tpl.message).insertBefore(this.input);l(this.settings.tpl.errorLine).appendTo(e),!0===this.isTouchDevice()&&this.wrapper.addClass("touch-fallback"),this.input.attr("disabled")&&(this.isDisabled=!0,this.wrapper.addClass("disabled")),!0===this.settings.showLoader&&(this.loader=l(this.settings.tpl.loader),this.loader.insertBefore(this.input)),this.preview=l(this.settings.tpl.preview),this.preview.insertAfter(this.input),!1===this.isDisabled&&!0===this.settings.showRemove&&(this.clearButton=l(this.settings.tpl.clearButton),this.clearButton.insertAfter(this.input),this.clearButton.on("click",this.clearElement)),this.filenameWrapper=l(this.settings.tpl.filename),this.filenameWrapper.prependTo(this.preview.find(".file-upload-infos-inner")),!0===this.settings.showErrors&&(this.errorsContainer=l(this.settings.tpl.errorsContainer),"outside"===this.settings.errorsPosition?this.errorsContainer.insertAfter(this.wrapper):this.errorsContainer.insertBefore(this.input));var i=this.settings.defaultFile||"";""!==i.trim()&&(this.file.name=this.cleanFilename(i),this.setPreview(this.isImage(),i))},t.prototype.readFile=function(e){var i,t,s,r,n,o;e.files&&e.files[0]&&(i=new FileReader,t=new Image,s=e.files[0],r=null,n=this,o=l.Event("file_upload.fileReady"),this.clearErrors(),this.showLoader(),this.setFileInformations(s),this.errorsEvent.errors=[],this.checkFileSize(),this.isFileExtensionAllowed(),this.isImage()&&this.file.size<this.sizeToByte(this.settings.maxFileSizePreview)?(this.input.on("file_upload.fileReady",this.onFileReady),i.readAsDataURL(s),i.onload=function(e){r=e.target.result,t.src=e.target.result,t.onload=function(){n.setFileDimensions(this.width,this.height),n.validateImage(),n.input.trigger(o,[!0,r])}}):this.onFileReady(!1))},t.prototype.onFileReady=function(e,i,t){if(this.input.off("file_upload.fileReady",this.onFileReady),0===this.errorsEvent.errors.length)this.setPreview(i,t);else{this.input.trigger(this.errorsEvent,[this]);for(var s,r=this.errorsEvent.errors.length-1;0<=r;r--){var n=this.errorsEvent.errors[r].namespace.split(".").pop();this.showError(n)}void 0!==this.errorsContainer&&(this.errorsContainer.addClass("visible"),s=this.errorsContainer,setTimeout(function(){s.removeClass("visible")},this.settings.errorTimeout)),this.wrapper.addClass("has-error"),this.resetPreview(),this.clearElement()}},t.prototype.setFileInformations=function(e){this.file.object=e,this.file.name=e.name,this.file.size=e.size,this.file.type=e.type,this.file.width=null,this.file.height=null},t.prototype.setFileDimensions=function(e,i){this.file.width=e,this.file.height=i},t.prototype.setPreview=function(e,i){this.wrapper.removeClass("has-error").addClass("has-preview"),this.filenameWrapper.children(".file-upload-filename-inner").html(this.file.name);var t,s=this.preview.children(".file-upload-render");this.hideLoader(),!0===e?(t=l('<img class="file-upload-preview-img" />').attr("src",i),this.settings.height&&t.css("max-height",this.settings.height),t.appendTo(s)):(l("<i />").attr("class","fas fa-file").appendTo(s),l('<span class="file-upload-extension" />').html(this.getFileType()).appendTo(s)),this.preview.fadeIn()},t.prototype.resetPreview=function(){this.wrapper.removeClass("has-preview");var e=this.preview.children(".file-upload-render");e.find(".file-upload-extension").remove(),e.find("i").remove(),e.find(".file-upload-preview-img").remove(),this.preview.hide(),this.showLoader()},t.prototype.cleanFilename=function(e){var i=e.split("\\").pop();return i==e&&(i=e.split("/").pop()),""!==e?i:""},t.prototype.clearElement=function(){var e;0===this.errorsEvent.errors.length?(e=l.Event("file_upload.beforeClear"),this.input.trigger(e,[this]),!1!==e.result&&(this.resetFile(),this.input.val(""),this.resetPreview(),this.input.trigger(l.Event("file_upload.afterClear"),[this]))):(this.resetFile(),this.input.val(""),this.resetPreview())},t.prototype.resetFile=function(){this.file.object=null,this.file.name=null,this.file.size=null,this.file.type=null,this.file.width=null,this.file.height=null},t.prototype.setContainerSize=function(){this.settings.height&&this.wrapper.height(this.settings.height)},t.prototype.isTouchDevice=function(){return"ontouchstart"in window||0<navigator.MaxTouchPoints||0<navigator.msMaxTouchPoints},t.prototype.getFileType=function(){return this.file.name.split(".").pop().toLowerCase()},t.prototype.isImage=function(){return"-1"!=this.settings.imgFileExtensions.indexOf(this.getFileType())},t.prototype.isFileExtensionAllowed=function(){return"-1"!=this.settings.allowedFileExtensions.indexOf("*")||"-1"!=this.settings.allowedFileExtensions.indexOf(this.getFileType())||(this.pushError("fileExtension"),!1)},t.prototype.translateMessages=function(){for(var e in this.settings.tpl)for(var i in this.settings.messages)this.settings.tpl[e]=this.settings.tpl[e].replace("{{ "+i+" }}",this.settings.messages[i])},t.prototype.checkFileSize=function(){0!==this.sizeToByte(this.settings.maxFileSize)&&this.file.size>this.sizeToByte(this.settings.maxFileSize)&&this.pushError("fileSize")},t.prototype.sizeToByte=function(e){var i,t,s=0;return 0!==e&&(t=1048576,"K"===(i=e.slice(-1).toUpperCase())?s=1024*parseFloat(e):"M"===i?s=parseFloat(e)*t:"G"===i&&(s=1073741824*parseFloat(e))),s},t.prototype.validateImage=function(){0!==this.settings.minWidth&&this.settings.minWidth>=this.file.width&&this.pushError("minWidth"),0!==this.settings.maxWidth&&this.settings.maxWidth<=this.file.width&&this.pushError("maxWidth"),0!==this.settings.minHeight&&this.settings.minHeight>=this.file.height&&this.pushError("minHeight"),0!==this.settings.maxHeight&&this.settings.maxHeight<=this.file.height&&this.pushError("maxHeight"),"-1"==this.settings.allowedFormats.indexOf(this.getImageFormat())&&this.pushError("imageFormat")},t.prototype.getImageFormat=function(){return this.file.width==this.file.height?"square":this.file.width<this.file.height?"portrait":this.file.width>this.file.height?"landscape":void 0},t.prototype.pushError=function(e){var i=l.Event("file_upload.error."+e);this.errorsEvent.errors.push(i),this.input.trigger(i,[this])},t.prototype.clearErrors=function(){void 0!==this.errorsContainer&&this.errorsContainer.children("ul").html("")},t.prototype.showError=function(e){void 0!==this.errorsContainer&&this.errorsContainer.children("ul").append("<li>"+this.getError(e)+"</li>")},t.prototype.getError=function(e){var i=this.settings.error[e],t="";return"fileSize"===e?t=this.settings.maxFileSize:"minWidth"===e?t=this.settings.minWidth:"maxWidth"===e?t=this.settings.maxWidth:"minHeight"===e?t=this.settings.minHeight:"maxHeight"===e?t=this.settings.maxHeight:"imageFormat"===e?t=this.settings.allowedFormats.join(", "):"fileExtension"===e&&(t=this.settings.allowedFileExtensions.join(", ")),""!==t?i.replace("{{ value }}",t):i},t.prototype.showLoader=function(){void 0!==this.loader&&this.loader.show()},t.prototype.hideLoader=function(){void 0!==this.loader&&this.loader.hide()},t.prototype.destroy=function(){this.input.siblings().remove(),this.input.unwrap(),this.isInit=!1},t.prototype.init=function(){this.createElements()},t.prototype.isDropified=function(){return this.isInit},l.fn[i]=function(e){return this.each(function(){l.data(this,i)||l.data(this,i,new t(this,e))}),this},t});
